{"version":3,"sources":["index.js"],"names":["NS","DEF_STATE_NAME","DEF_NO_STATE_NAME","ds","isBrowser","window","suppressWarnings","instances","DriftState","el","property","cssState","cssNoState","stateTarget","getTransformName","css","uid","getUID","canDrift","supportsTransitions","hanldeTransEnd","classList","add","cl","duration","forEach","itm","idx","parseFloat","getComputedStyle","offsetWidth","whichTransitionEvent","t","document","createElement","transitions","style","undefined","evtFired","transitionEvent","fun","evt","console","log","propertyName","remove","removeEventListener","addEventListener","b","body","documentElement","s","p","v","charAt","toUpperCase","substr","i","length","st","rtnObj","js","getPropertyValue","pref","Math","random","toString","replace","firstChar","parseInt","checkEl","opts","tagName","toLowerCase","err","funName","msg","val","warn","push","apply","Error","join","go","inst","testable","getCssState","getCssNoState","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["const NS = \"driftState\";\r\nconst DEF_STATE_NAME = \"adrift\";\r\nconst DEF_NO_STATE_NAME = \"no-drift\";\r\n\r\nvar ds = {};\r\nvar isBrowser = typeof window !== \"undefined\";\r\nif(isBrowser) ds = window[NS] = {};\r\n\r\nvar suppressWarnings = false;\r\n\r\nvar instances = [];\r\n\r\nclass DriftState {\r\n\r\n    constructor(el, property, cssState, cssNoState, stateTarget) {\r\n\r\n        this.el = el;\r\n        this.stateTarget = stateTarget || el;\r\n        \r\n        this.property = property;\r\n        if(this.property === \"transform\") this.property = getTransformName().css;\r\n\r\n        //if(isBrowser) console.log(\"getTransformName\", getTransformName());\r\n        \r\n        this.cssState = cssState;\r\n        this.cssNoState = cssNoState;\r\n        this.uid = getUID();\r\n    }\r\n\r\n    go() {\r\n        var canDrift = supportsTransitions();\r\n        var el = this.el;\r\n\r\n        if( canDrift )  hanldeTransEnd(el, this.stateTarget, this.cssState, this.property)\r\n        else            this.stateTarget.classList.add(this.cssNoState);\r\n\r\n        // check the various CSS properties to see if a duration has been set\r\n        var cl = [\"transition-duration\", \"-moz-transition-duration\", \"-webkit-transition-duration\", \"-o-transition-duration\"];\r\n        var duration = 0;\r\n        cl.forEach((itm, idx) => {\r\n            duration || (duration = parseFloat( window.getComputedStyle(el, itm) ));\r\n        });\r\n\r\n        // Should really add delay here as well, right?\r\n\r\n        // if I have a duration then add the class\r\n        if (duration !== 0) {\r\n            if( canDrift ) this.stateTarget.classList.add(this.cssState);\r\n            el.offsetWidth; // check offsetWidth to force the style rendering\r\n        };\r\n    }\r\n}\r\n\r\n\r\n/* From Modernizr */\r\nfunction whichTransitionEvent(){\r\n    var t;\r\n    var el = document.createElement('fakeelement');\r\n    var transitions = {\r\n      'transition':'transitionend',\r\n      'OTransition':'oTransitionEnd',\r\n      'MozTransition':'transitionend',\r\n      'WebkitTransition':'webkitTransitionEnd'\r\n    }\r\n\r\n    for(t in transitions){\r\n        if( el.style[t] !== undefined ){\r\n            return transitions[t];\r\n        }\r\n    }\r\n}\r\n\r\nfunction hanldeTransEnd(el, stateTarget, cssState, property) {\r\n    var evtFired = false;\r\n\r\n\r\n    var transitionEvent = whichTransitionEvent();\r\n\r\n    var fun = function(evt){\r\n\r\n        console.log(\"evt.propertyName\", evt.propertyName)\r\n\r\n        // just triggers for one property type (if specified)\r\n        if( property && evt.propertyName !== property ) return;\r\n\r\n        // stops multiple events triggering\r\n        if(!evtFired) {\r\n            evtFired = true;\r\n            stateTarget.classList.remove(cssState);\r\n\r\n            // console.log(NS, \"trans end\");\r\n\r\n            el.removeEventListener(transitionEvent, fun);\r\n        }\r\n    }\r\n    transitionEvent && el.addEventListener(transitionEvent, fun, false);\r\n}\r\n\r\n\r\n// Checks if transitions are supported\r\nfunction supportsTransitions() {\r\n    var b = document.body || document.documentElement,\r\n        s = b.style,\r\n        p = 'transition';\r\n\r\n    if (typeof s[p] == 'string') { return true; }\r\n\r\n    // Tests for vendor specific prop\r\n    var v = ['Moz', 'webkit', 'Webkit', 'Khtml', 'O', 'ms'];\r\n    p = p.charAt(0).toUpperCase() + p.substr(1);\r\n\r\n    for (var i=0; i<v.length; i++) {\r\n        if (typeof s[v[i] + p] == 'string') { return true; }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n// gets the CSS & JS name of the 'transform' property, which can vary from browser to browser\r\nfunction getTransformName() {\r\n    var st = window.getComputedStyle(document.body, null);\r\n\r\n    var rtnObj = {\r\n        css: null, js: null\r\n    }\r\n    \r\n    if( st.getPropertyValue(\"transform\") !== null ) {\r\n        rtnObj.css = \"transform\";\r\n        rtnObj.js = \"transform\";\r\n        return rtnObj;\r\n    }\r\n\r\n    if( st.getPropertyValue(\"-webkit-transform\") !== null ) {\r\n        rtnObj.css = \"-webkit-transform\";\r\n        rtnObj.js = \"webkitTransform\";\r\n        return rtnObj;\r\n    }\r\n\r\n    if( st.getPropertyValue(\"-moz-transform\") !== null )    {\r\n        rtnObj.css = \"-moz-transform\";\r\n        rtnObj.js = \"MozTransform\";\r\n        return rtnObj;\r\n    }\r\n    \r\n    if( st.getPropertyValue(\"-ms-transform\") !== null ) {\r\n        rtnObj.css = \"-ms-transform\";\r\n        rtnObj.js = \"msTransform\";\r\n        return rtnObj;\r\n    }\r\n    \r\n    if( st.getPropertyValue(\"-o-transform\") !== null ) {\r\n        rtnObj.css = \"-o-transform\";\r\n        rtnObj.js = \"OTransform\";\r\n        return rtnObj;\r\n    }\r\n    \r\n    return null;\r\n}\r\n\r\n\r\n/**\r\n * @description Gets a unique string, with an optional prefix that can be useful for human readability.\r\n * @param pref (string) optional - A prefix string for the unique id.\r\n * @return (string) The unique id.\r\n */\r\nfunction getUID(pref) {\r\n    var uid = (pref || \"\") + Math.random().toString().replace(\".\", \"\");\r\n\r\n    // ensure starts with a letter, as CSS class names should not start with a number\r\n    var firstChar = uid.substr(0,1);\r\n    if( parseInt(firstChar).toString() !== \"NaN\" ) uid = \"a-\"+uid;\r\n\r\n    return uid;\r\n}\r\n\r\n// check if given object has is an HTMLElement called 'el'\r\nfunction checkEl(opts) {\r\n    if(!opts.el) return false;\r\n    return (typeof opts.el.tagName).toLowerCase() !== \"string\";\r\n}\r\n\r\nfunction err(funName, msg, val) {\r\n    var warn = [NS, funName];\r\n    if(typeof val !== \"undefined\") warn.push(val);\r\n    if(!suppressWarnings) console.warn.apply(this, warn);\r\n    throw Error([NS, funName, msg].join(\", \"));\r\n}\r\n\r\n\r\n// main initializing function. Returns opts, which may have been modified.\r\nds.go = function(opts) {\r\n    \r\n    // check opts are valid first\r\n    if(!opts) err(\"go\", \"'opts' was not defined\", opts);\r\n    if(checkEl(opts)) err(\"go\", \"'opts.el' was not an HTMLElement\", opts.el);\r\n    if(opts.stateTarget && checkEl(opts)) err(\"go\", \"'opts.stateTarget' was not an HTMLElement\", opts.stateTarget);\r\n    if(typeof opts.property !== \"string\") err(\"go\", \"'opts.property' was not a valid string\", opts.property);\r\n    \r\n    if(typeof opts.cssState !== \"string\") {\r\n        opts.cssState = DEF_STATE_NAME;\r\n        if(!suppressWarnings)\r\n            console.log(NS, \"go\", \"No 'opts.cssState' given, so defaulting to \" + DEF_STATE_NAME + \".\");\r\n    }\r\n    \r\n    if(typeof opts.cssNoState !== \"string\") {\r\n        opts.cssNoState = DEF_NO_STATE_NAME;\r\n        if(!suppressWarnings)\r\n            console.log(NS, \"go\", \"No 'opts.cssNoState' given, so defaulting to \" + DEF_NO_STATE_NAME + \".\");\r\n    }\r\n\r\n    var inst = new DriftState(opts.el, opts.property, opts.cssState, opts.cssNoState, opts.stateTarget);\r\n    instances.push(inst);\r\n\r\n    if(isBrowser) inst.go();\r\n\r\n    return inst;\r\n}\r\n\r\nds.testable = {\r\n    suppressWarnings: function(val) {\r\n        suppressWarnings = val;\r\n    },\r\n    getCssState: function() {\r\n        return DEF_STATE_NAME;\r\n    },\r\n    getCssNoState: function() {\r\n        return DEF_NO_STATE_NAME;\r\n    },\r\n    getUID: getUID\r\n}\r\n\r\n// make available in Common.js\r\nif(!isBrowser) module.exports = ds; "],"sourceRoot":"/source/"}